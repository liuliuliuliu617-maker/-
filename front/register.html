<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>注册</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f5f7fb; margin: 0; }
    .container { max-width: 420px; margin: 8vh auto; background: #fff; padding: 24px; border-radius: 8px; box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
    h1 { margin: 0 0 16px; font-size: 22px; color: #222; }
    .field { margin-bottom: 14px; }
    .field label { display:block; font-size: 13px; color: #555; margin-bottom:6px; }
    .field input { width:100%; box-sizing: border-box; padding:10px 12px; border:1px solid #dcdcdc; border-radius:6px; font-size:14px; }
    .actions { margin-top: 16px; }
    button { width:100%; padding:10px 12px; border:none; border-radius:6px; background:#2f9e44; color:#fff; font-size:15px; cursor:pointer; }
    button:disabled { background:#8fd19e; cursor:default; }
    .msg { margin-top: 10px; font-size: 13px; }
    .msg.success { color: #2f9e44; }
    .msg.error { color: #c92a2a; }
    .tip { margin-top: 10px; font-size: 12px; color:#666; }
  </style>
</head>
<body>
  <div class="container">
    <h1>用户注册</h1>
    <div class="field">
      <label for="name">用户名</label>
      <input id="name" type="text" placeholder="例如：lanyifei">
    </div>
    <div class="field">
      <label for="account">账号</label>
      <input id="account" type="text" placeholder="例如：123456">
    </div>
    <div class="field">
      <label for="password">密码</label>
      <input id="password" type="password" placeholder="请输入密码">
    </div>
    <div class="actions">
      <button id="registerBtn">注册</button>
    </div>
    <div id="msg" class="msg"></div>
    <div class="tip">已注册？<a href="/">去登录</a></div>
  </div>

  <script>
  (function(){
    const nameEl = document.getElementById('name');
    const accountEl = document.getElementById('account');
    const passwordEl = document.getElementById('password');
    const btn = document.getElementById('registerBtn');
    const msgEl = document.getElementById('msg');

    function setLoading(loading){ btn.disabled = loading; btn.textContent = loading ? '提交中...' : '注册'; }
    function showMessage(text, type){ msgEl.textContent = text || ''; msgEl.className = 'msg ' + (type || ''); }

    async function doRegister(){
      const name = (nameEl.value||'').trim();
      const account = (accountEl.value||'').trim();
      const password = (passwordEl.value||'').trim();

      if(!name){ showMessage('请输入用户名','error'); nameEl.focus(); return; }
      if(!account){ showMessage('请输入账号','error'); accountEl.focus(); return; }
      if(!password){ showMessage('请输入密码','error'); passwordEl.focus(); return; }

      setLoading(true); showMessage('', '');
      try{
        const res = await fetch('/api/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name, account, password })
        });
        const json = await res.json().catch(()=>({success:false,message:'服务器返回错误'}));
        if(res.ok && json.success){
          showMessage('注册成功，正在跳转登录...','success');
          setTimeout(()=>{ window.location.href = '/'; }, 1000);
        }else{
          showMessage(json.message || '注册失败', 'error');
        }
      }catch(err){
        showMessage('网络或服务器错误', 'error');
      }finally{
        setLoading(false);
      }
    }

    btn.addEventListener('click', doRegister);
    [nameEl, accountEl, passwordEl].forEach(el => el.addEventListener('keydown', e => { if(e.key==='Enter') doRegister(); }));
  })();
  </script>
</body>
</html>
